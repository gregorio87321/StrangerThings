(this["webpackJsonpstranger-things"]=this["webpackJsonpstranger-things"]||[]).push([[0],{37:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),s=n(5),a=n(4),o=(n(23),n(1)),i=n(19),u=n.n(i),l=n(8),j=n(3),p=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,r,s,a,o,i,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,r=t.method,s=t.token,a=t.body,e.prev=1,o={method:r?r.toUpperCase():"GET",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},s&&(o.headers.Authorization="Bearer ".concat(s)),e.next=6,fetch("https://strangers-things.herokuapp.com/api/2108-LSU-RM-WEB-PT"+n,o);case 6:return i=e.sent,e.next=9,i.json();case 9:if(!(u=e.sent).error){e.next=12;break}throw u.error;case 12:return e.abrupt("return",u);case 15:return e.prev=15,e.t0=e.catch(1),console.error("ERROR: ",e.t0),e.abrupt("return",e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}();var b=n(0),h=function(e){var t=e.setToken,n=Object(o.useState)(""),r=Object(a.a)(n,2),i=r[0],u=r[1],h=Object(o.useState)(""),d=Object(a.a)(h,2),O=d[0],x=d[1],f=Object(j.f)(),v=function(){var e=Object(s.a)(c.a.mark((function e(n){var r,s,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r={user:{username:i,password:O}},e.prev=2,e.next=5,p({url:"/users/login",method:"POST",body:r});case 5:s=e.sent,a=s.data,o=a.token,localStorage.setItem("token",JSON.stringify(o)),t(o),f.push("/posts"),console.log("token",o),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{style:{textAlign:"center"},children:"Log In"}),Object(b.jsxs)("form",{onSubmit:v,children:[Object(b.jsx)("input",{type:"text",placeholder:"Username",value:i,onChange:function(e){return u(e.target.value)}}),Object(b.jsx)("input",{type:"password",placeholder:"Password",value:O,onChange:function(e){return x(e.target.value)}}),Object(b.jsx)("button",{type:"submit",children:"Login"})]}),Object(b.jsx)(l.b,{to:"/register",children:"Don't have an account? Sign Up"})]})},d=n(12),O=n(11),x=n(13),f=function(e){var t=e.token,n=e.setPosts,r=e.posts,i=e.action,u=Object(j.f)(),l=Object(j.g)().postId,h=Object(o.useState)({title:"",description:"",price:0,location:"",willDeliver:!1}),f=Object(a.a)(h,2),v=f[0],g=f[1],m="edit"===i,w=m?"Edit this post":"Add a New Post",k=m?"PATCH":"POST",y=m?"/posts/".concat(l):"/posts",S=function(){var e=Object(s.a)(c.a.mark((function e(s){var a,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.preventDefault(),e.prev=1,e.next=4,p({url:y,method:k,body:{post:{title:v.title,description:v.description,price:v.price,location:v.location,willDeliver:v.willDeliver}},token:t});case 4:a=e.sent,o=a.data.post,m?(i=r.filter((function(e){return e._id!==l})),n([].concat(Object(d.a)(i),[o]))):n([].concat(Object(d.a)(r),[o])),u.push("/posts"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("error adding a post: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),C=function(e){return function(t){g("willDeliver"===e?Object(x.a)(Object(x.a)({},v),{},Object(O.a)({},e,t.target.checked)):Object(x.a)(Object(x.a)({},v),{},Object(O.a)({},e,t.target.value)))}};return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h2",{className:"newPostHead",children:w}),Object(b.jsx)("div",{className:"newPost",children:Object(b.jsxs)("form",{className:"newPost",onSubmit:S,children:[Object(b.jsx)("input",{type:"text",placeholder:"title",onChange:C("title"),value:v.title}),Object(b.jsx)("input",{type:"text",placeholder:"description",onChange:C("description"),value:v.description}),Object(b.jsx)("input",{type:"number",placeholder:"price",onChange:C("price"),value:v.price}),Object(b.jsx)("input",{type:"text",placeholder:"location",onChange:C("location"),value:v.location}),Object(b.jsxs)("label",{children:["Deliver ?",Object(b.jsx)("input",{type:"checkbox",onChange:C("willDeliver"),value:v.willDeliver})]}),Object(b.jsx)("button",{children:w})]})})]})},v={searchContainer:{display:"flex",justifyContent:"center",padding:"16px",alignItems:"center"},searchInput:{margin:"0 16px"}},g=function(e){var t=e.token,n=e.posts,r=e.userData,c=Object(o.useState)(""),s=Object(a.a)(c,2),i=s[0],u=s[1],l=Object(o.useState)(!1),p=Object(a.a)(l,2),h=p[0],O=p[1],x=Object(o.useState)(Object(d.a)(n)),g=Object(a.a)(x,2),m=(g[0],g[1]),w=n.filter((function(e){return function(e,t){for(var n=t.toLowerCase(),r=0,c=[e.description,e.location,e.title,e.author.username];r<c.length;r++)if(c[r].toLowerCase().includes(n))return!0}(e,i)})),k=Object(j.f)();return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{style:v.searchContainer,children:[Object(b.jsx)("h2",{className:"allPosts",children:"Posts"}),Object(b.jsx)("input",{style:v.searchInput,type:"text",placeholder:"search for posts",value:i,onChange:function(e){u(e.target.value)}})]}),r.username&&!h?Object(b.jsx)("button",{onClick:function(e){e.preventDefault(),O(!0)},children:"New Post"}):null,h?Object(b.jsx)(f,{token:t,setPosts:function(e){return function(e){m(e),O(!1)}(e)},posts:n,action:"create"}):w.map((function(e){return Object(b.jsxs)("div",{children:[Object(b.jsx)("h3",{className:"posts",children:e.title}),Object(b.jsx)("span",{children:e.description}),Object(b.jsx)("br",{}),Object(b.jsxs)("span",{children:["Price: ",e.price]}),Object(b.jsx)("br",{}),Object(b.jsxs)("span",{children:["Seller: ",e.author.username]}),Object(b.jsx)("br",{}),Object(b.jsxs)("span",{children:["Location: ",e.location]}),Object(b.jsx)("br",{}),Object(b.jsx)("button",{className:"btn-info",onClick:function(){return k.push("/posts/".concat(e._id))},children:" view post"}),Object(b.jsx)("button",{className:"send_message btn-info",onClick:function(e){e.preventDefault()},children:"SEND MESSAGE"})]},e._id)}))]})},m=function(e){var t=e.setToken,n=Object(o.useState)(""),r=Object(a.a)(n,2),i=r[0],u=r[1],h=Object(o.useState)(""),d=Object(a.a)(h,2),O=d[0],x=d[1],f=Object(j.f)(),v=function(){var e=Object(s.a)(c.a.mark((function e(n){var r,s,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r={user:{username:i,password:O}},e.prev=2,e.next=5,p({url:"/users/register",method:"POST",body:r});case 5:s=e.sent,a=s.data,o=a.token,localStorage.setItem("token",JSON.stringify(o)),t(o),f.push("/posts"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{style:{textAlign:"center"},children:"Register"}),Object(b.jsxs)("form",{onSubmit:v,children:[Object(b.jsx)("input",{type:"text",placeholder:"Username",value:i,onChange:function(e){return u(e.target.value)}}),Object(b.jsx)("input",{type:"password",placeholder:"Password",value:O,onChange:function(e){return x(e.target.value)}}),Object(b.jsx)("button",{type:"submit",children:"Register"})]}),Object(b.jsx)(l.b,{to:"/Login",children:"Already have an account? Log In"})]})},w=function(e){var t=e.posts,n=(e.token,e.setPosts,e.userData,Object(j.g)().postId),r=t.find((function(e){return n===e._id}));return Object(b.jsx)(b.Fragment,{children:r?Object(b.jsxs)("div",{children:[Object(b.jsx)("h3",{children:r.title}),Object(b.jsxs)("p",{children:["Posted by: ",r.author.username]}),Object(b.jsxs)("p",{children:["Price: ",r.price]}),Object(b.jsxs)("p",{children:["Location: ",r.location]}),Object(b.jsxs)("p",{children:["Delivers: ",r.willDeliver?"Yes":"No"]})]}):""})},k=function(){var e=Object(o.useState)(""),t=Object(a.a)(e,2),n=t[0],r=t[1],i=Object(o.useState)({}),u=Object(a.a)(i,2),d=u[0],O=u[1],x=Object(o.useState)([]),f=Object(a.a)(x,2),v=f[0],k=f[1],y=Object(j.f)(),S=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({url:"/users/me",token:t});case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(s.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({url:"/posts"});case 2:return t=e.sent,n=t.data.posts,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(o.useEffect)(Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return r(localStorage.getItem("token")),e.abrupt("return");case 3:return e.next=5,S(n);case 5:(t=e.sent)&&t.username&&O(t);case 7:case"end":return e.stop()}}),e)}))),[n]),Object(o.useEffect)(Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:t=e.sent,k(t);case 4:case"end":return e.stop()}}),e)}))),[]);var P=function(){var e=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.removeItem("token"),y.push("/posts"),window.location.reload(!1);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{className:"title",children:" Stranger Things "}),Object(b.jsx)(b.Fragment,{children:n?Object(b.jsx)("button",{className:"btn-primary",onClick:function(e){P()},children:"Log Out"}):Object(b.jsx)(l.b,{to:"/login",children:"Log In"})}),n?Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("h2",{className:"user_greeting",children:[" Hello ",d.username,"! "]})}):"",Object(b.jsx)(l.b,{style:{marginLeft:"10px"},to:"/posts",children:"Posts"})]}),Object(b.jsxs)(j.c,{children:[Object(b.jsx)(j.a,{path:"/login",children:Object(b.jsx)(h,{action:"login",setToken:r})}),Object(b.jsx)(j.a,{path:"/register",children:Object(b.jsx)(m,{action:"register",setToken:r})}),Object(b.jsx)(j.a,{path:"/posts",children:Object(b.jsx)(g,{token:n,posts:v,userData:d})}),Object(b.jsx)(j.a,{path:"/post/:postId",children:Object(b.jsx)(w,{posts:v,token:n,userData:d,setPosts:k})})]})]})};u.a.render(Object(b.jsx)(l.a,{children:Object(b.jsx)(k,{})}),document.getElementById("app"))}},[[37,1,2]]]);
//# sourceMappingURL=main.fd025e6b.chunk.js.map